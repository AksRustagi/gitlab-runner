.common_conditions:
  open: &open
    state: opened
  no_milestone: &no_milestone
    <<: *open
    milestone:
      - No Milestone
  backlog: &backlog
    <<: *open
    milestone:
      - Backlog
.common_actions:
  scheduling_mismatch: &scheduling_mismatch
    mention:
      - bikebilly

resource_rules:
  issues:
    rules:
      - name: Mark stale issues with no milestone for closure
        conditions:
          <<: *no_milestone
          date:
            attribute: updated_at
            condition: older_than
            interval_type: months
            interval: 12
        actions:
          labels:
            - awaiting feedback
            - auto updated
          mention:
            - markglenfletcher
          comment: |
            Hi,

            First of all, thank you for raising an issue to help improve the GitLab Runner product. We're sorry about this, but this particular issue has gone unnoticed for quite some time. To establish order in the GitLab-Runner Issue Tracker, we must ensure that every issue is correctly labelled and triaged, to get the proper attention.

            We are automatically labelling this issue for attention as it meets the following criteria:
            * No activity in the past 12 months
            * No milestone (unscheduled)

            We'd like to ask you to help us out and determine whether this issue should be stay open or be closed.

            If this issue is reporting a bug, please can you attempt to reproduce on the latest version of the runner, to help us to understand whether the bug still needs our attention.

            If this issue is proposing a new feature, please can you verify whether the feature proposal is still relevant.

            Thanks for your help

      - name: Mark stale issues for closure
        conditions:
          date:
            attribute: updated_at
            condition: older_than
            interval_type: months
            interval: 3
          forbidden_labels:
            - bug
            - feature proposal
          state: opened
        actions:
          labels:
            - awaiting feedback
            - auto updated
          mention:
            - markglenfletcher
          comment: |
            Hi,

            First of all, thank you for raising an issue to help improve the GitLab Runner product. We're sorry about this, but this particular issue has gone unnoticed for quite some time. To establish order in the GitLab-Runner Issue Tracker, we must ensure that every issue is correctly labelled and triaged, to get the proper attention.

            We are automatically labelling this issue for attention as it meets the following criteria:
            * No activity in the past 3 months
            * Not labeled as ~bug or ~"feature proposal"

            We'd like to ask you to help us out and determine whether this issue should be stay open or be closed.

            If this issue is reporting a bug, please can you attempt to reproduce on the latest version of the runner, to help us to understand whether the bug still needs our attention.

            If this issue is proposing a new feature, please can you verify whether the feature proposal is still relevant.

            Thanks for your help

      - name: Mark stale bugs for closure
        conditions:
          <<: *no_milestone
          date:
            attribute: updated_at
            condition: older_than
            interval_type: months
            interval: 6
          labels:
            - bug
        actions:
          labels:
            - awaiting feedback
            - auto updated
          mention:
            - markglenfletcher
          comment: |
            Hi,

            First of all, thank you for raising an issue to help improve the GitLab Runner product. We're sorry about this, but this particular issue has gone unnoticed for quite some time. To establish order in the GitLab-Runner Issue Tracker, we must ensure that every issue is correctly labelled and triaged, to get the proper attention.

            We are automatically labelling this issue for attention as it meets the following criteria:
            * Issue is open
            * No activity in the past 6 months
            * Labelled as a bug
            * Unscheduled (no milestone)

            We'd like to ask you to help us out and determine whether this issue should be stay open or be closed.

            Because this issue is reporting a bug, please can you attempt to reproduce on the latest version of the runner, to help us to understand whether the bug still needs our attention.

            Thanks for your help

      - name: Close non-updated issues
        conditions:
          date:
            attribute: updated_at
            condition: older_than
            interval_type: weeks
            interval: 2
          labels:
            - awaiting feedback
            - auto updated
          state: opened
        actions:
          labels:
            - auto closed
          mention:
            - markglenfletcher
          status: close
          comment: |
            Closing this issue down in accordance with our [Issue Triage Policies](https://gitlab.com/gitlab-org/gitlab-runner/blob/gl-gitlab-triage-policies/.triage-policies.yml). Please reopen the issue if you feel that the issue is still relevant. Thanks!

      - name: Assign CI/CD label to deliverables
        conditions:
          state: opened
          labels:
            - Deliverable
          forbidden_labels:
            - CI/CD
        actions:
          labels:
            - CI/CD

      - name: Assign CI/CD label to stretch
        conditions:
          state: opened
          labels:
            - Stretch
          forbidden_labels:
            - CI/CD
        actions:
          labels:
            - CI/CD
      #
      # scheduling mismatches
      #

      - name: Remove ~Deliverable from %Backlog
        conditions:
          <<: *backlog
          labels: [ Deliverable ]
        actions:
          <<: *scheduling_mismatch
          remove_labels: [ Deliverable ]
      - name: Remove ~Deliverable from Unscheduled
        conditions:
          <<: *no_milestone
          labels: [ Deliverable ]
        actions:
          <<: *scheduling_mismatch
          remove_labels: [ Deliverable ]
      - name: Remove ~Stretch from %Backlog
        conditions:
          <<: *backlog
          labels: [ Stretch ]
        actions:
          <<: *scheduling_mismatch
          remove_labels: [ Stretch ]
      - name: Remove ~Stretch from Unscheduled
        conditions:
          <<: *no_milestone
          labels: [ Stretch ]
        actions:
          <<: *scheduling_mismatch
          remove_labels: [ Stretch ]
      - name: Remove ~"Next Patch Release" from %Backlog
        conditions:
          <<: *backlog
          labels: [ "Next Patch Release" ]
        actions:
          <<: *scheduling_mismatch
          remove_labels: [ "Next Patch Release" ]
      - name: Remove ~"Next Patch Release" from Unscheduled
        conditions:
          <<: *no_milestone
          labels: [ "Next Patch Release" ]
        actions:
          <<: *scheduling_mismatch
          remove_labels: [ "Next Patch Release" ]

